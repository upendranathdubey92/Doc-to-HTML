<!DOCTYPE html>
<html>
<head>
    <title>Test CTA_TWO Web IDE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 300px; font-family: monospace; }
        .results { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .success { background: #e8f5e8; color: #2e7d32; padding: 10px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; padding: 10px; margin: 10px 0; }
        pre { background: #f8f8f8; padding: 10px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Test CTA_TWO Web IDE Fix</h1>
    
    <textarea id="testContent">[CTA_TWO]
Ready to Build a Web Solution That Drives Results?

Whether you're a startup or an enterprise, we offer fully customized web development services built on the latest tech stacks to meet your business goals.

350+
Web Solutions Delivered

20+
Frameworks & Tools Mastered

100%
SEO & Mobile Optimized

15+ 
Years of Dev Expertise

Request a Free Proposal View Portfolio
[CTA_TWO END]</textarea>
    
    <br><br>
    <button onclick="testCtaTwo()">Test CTA_TWO Generation</button>
    
    <div id="results" class="results"></div>

    <script>
        const supportedSections = ['HERO', 'FAQ', 'CTA_SIMPLE', 'CTA_ENHANCED', 'CTA_TWO', 'PROCESS', 'TECHNOLOGY', 'INDUSTRIES', 'SERVICES_GRID', 'SERVICES_ACCORDION', 'PORTFOLIO', 'TESTIMONIAL', 'BENEFITS', 'BENEFITS_TWO', 'CONTENT_FORM'];
        
        function detectSections(content) {
            const sectionPattern = /\[([A-Z_\s]+)\]/g;
            const matches = [...content.matchAll(sectionPattern)];
            const detected = matches.map(match => match[1].trim());
            
            return [...new Set(detected)]
                .filter(section => !section.endsWith(' END'))
                .filter(section => 
                    supportedSections.some(supported => 
                        section.includes(supported) || supported.includes(section)
                    )
                );
        }
        
        function parseCtaTwoSection(content) {
            const lines = content.split('\\n').filter(line => line.trim());
            
            let title = '';
            let description = '';
            let stats = [];
            let buttons = '';
            
            // First line is title
            if (lines.length > 0) {
                title = lines[0].trim();
            }
            
            // Second line is description
            if (lines.length > 1) {
                description = lines[1].trim();
            }
            
            // Parse stats and buttons (number + description pairs)
            let i = 2;
            while (i < lines.length) {
                const line = lines[i].trim();
                if (line && /\\d/.test(line) && line.length < 10) {  // This is a stat number
                    const statNumber = line;
                    let statDescription = '';
                    if (i + 1 < lines.length && !/\\d/.test(lines[i + 1]) && !lines[i + 1].includes('Request')) {
                        statDescription = lines[i + 1].trim();
                        i += 2;
                    } else {
                        i += 1;
                    }
                    stats.push(`${statNumber} ${statDescription}`);
                } else if (line.includes('Request')) {
                    buttons = line;
                    i += 1;
                } else {
                    i += 1;
                }
            }
            
            return {
                title: title || 'Ready to Build a Web Solution That Drives Results?',
                description: description || 'Whether you\\'re a startup or an enterprise, we offer fully customized web development services.',
                stats: stats,
                buttons: buttons || 'Request a Free Proposal View Portfolio'
            };
        }
        
        function generateCtaTwoSection(content) {
            let statsHtml = '';
            const statImages = [
                'https://www.spaceotechnologies.com/wp-content/uploads/2025/06/Frame-1.svg',
                '/wp-content/uploads/2025/07/frameworks-tools-mastered.svg',
                '/wp-content/uploads/2025/07/seo-mobile-optimized.svg',
                '/wp-content/uploads/2025/07/years-of-dev-expertise.svg'
            ];
            
            if (content.stats && content.stats.length > 0) {
                content.stats.slice(0, 4).forEach((stat, index) => {
                    const imgSrc = statImages[index] || statImages[0];
                    const parts = stat.split(' ');
                    const number = parts[0];
                    const text = parts.slice(1).join(' ');
                    
                    statsHtml += `    <div class="new-button-group-inner">
        <img src="${imgSrc}">
        <strong>${number}</strong> ${text}
    </div>
`;
                });
            }

            const template = `<section class="pt50 pb80 new-cta-section">
<div class="container-xl">
<div class="cta-inner">
<div class="row align-items-center">
<div class="col-md-12 text-center">
<p class="fonts-40 font-weight-bold cta-title">{title}</p>
<p class="fonts-20 mxw-900">{description}</p>
</div>
<div class="new-button-group">
{stats_html}</div>
<div class="col-md-12 text-center mt-4 d-flex justify-content-center two-btn-group"><button class="btn btn-pop open-qouteform" type="button" data-medium="B_2">Request a Free Proposal</button> <a class="btn btn-pop open-qouteform white-btn" href="/project/">View Portfolio</a></div>
</div>
</div>
</div>
</section>`;

            return template
                .replace('{title}', content.title || 'Ready to Build a Web Solution That Drives Results?')
                .replace('{description}', content.description || 'Whether you\\'re a startup or an enterprise, we offer fully customized web development services.')
                .replace('{stats_html}', statsHtml);
        }
        
        function testCtaTwo() {
            const content = document.getElementById('testContent').value;
            const resultsDiv = document.getElementById('results');
            
            try {
                // Test detection
                const detectedSections = detectSections(content);
                
                let html = '<h3>CTA_TWO Test Results:</h3>';
                html += `<p><strong>Detected sections:</strong> ${JSON.stringify(detectedSections)}</p>`;
                
                if (detectedSections.includes('CTA_TWO')) {
                    html += '<div class="success">✅ CTA_TWO section detected correctly!</div>';
                    
                    // Test parsing
                    const lines = content.split('\\n');
                    let currentSection = null;
                    let currentContent = [];
                    
                    for (let line of lines) {
                        const trimmedLine = line.trim();
                        const sectionStartMatch = trimmedLine.match(/^\\[([A-Z_\\s]+)\\]$/);
                        if (sectionStartMatch && !sectionStartMatch[1].endsWith(' END')) {
                            currentSection = sectionStartMatch[1].trim();
                            currentContent = [];
                        } else if (trimmedLine.match(/^\\[([A-Z_\\s]+) END\\]$/)) {
                            if (currentSection === 'CTA_TWO') {
                                const contentText = currentContent.join('\\n').trim();
                                const parsedContent = parseCtaTwoSection(contentText);
                                const generatedHtml = generateCtaTwoSection(parsedContent);
                                
                                html += '<div class="success">✅ CTA_TWO generation successful!</div>';
                                html += `<p><strong>Parsed stats:</strong> ${JSON.stringify(parsedContent.stats)}</p>`;
                                html += '<h4>Generated HTML:</h4>';
                                html += `<pre>${generatedHtml}</pre>`;
                                break;
                            }
                        } else if (currentSection) {
                            currentContent.push(line);
                        }
                    }
                } else {
                    html += '<div class="error">❌ CTA_TWO section not detected</div>';
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>